name: Desplegar ProducciÃ³n desde Tag

on:
  workflow_dispatch:
    inputs:
      tag:
        description: 'VersiÃ³n/tag a desplegar (ej: 1.0.5)'
        required: true

jobs:
  deploy:
    name: Desplegar en ProducciÃ³n
    runs-on: ubuntu-latest
    environment:
      name: produccion

    steps:
      - name: ğŸ” Checkout del repositorio con el tag indicado
        uses: actions/checkout@v3
        with:
          ref: v${{ github.event.inputs.tag }}
          fetch-depth: 0

      - name: âš™ï¸ Instalar dependencias
        run: |
          sudo apt-get update
          sudo apt-get install -y postgresql-client
          pip install -r requirements.txt

      - name: ğŸš€ Ejecutar despliegue con scripts ya validados
        env:
          DB_NAME: ${{ secrets.PGDATABASE_PROD }}
          DB_USER: ${{ secrets.PGUSER_PROD }}
          DB_PASSWORD: ${{ secrets.PGPASSWORD_PROD }}
          DB_HOST: ${{ secrets.PGHOST_PROD }}
          DB_PORT: ${{ secrets.PGPORT_PROD }}
        run: python main.py

      - name: ğŸ‰ ConfirmaciÃ³n final
        run: echo "âœ… Despliegue en ProducciÃ³n completado con Ã©xito."
